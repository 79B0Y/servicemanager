参照node-red脚本包，进行matter-server服务管理脚本包设计，分别设计和创建每个脚本文件，以下是基本要求：


# matter-server 服务管理脚本包设计

**Service ID:** `matter-server`


## 脚本文件清单及功能说明

| 脚本名               | 功能描述                          |
| ----------------- | ----------------------------- |
| `common_paths.sh` | 统一路径定义                        |
| `install.sh`      | 安装 matter-server 服务                |
| `start.sh`        | 启动 matter-server 服务                |
| `stop.sh`         | 停止 matter-server 服务，恢复 `.disabled` |
| `status.sh`       | 查询服务运行状态，依据 PID 和 5580 端口     |
| `update.sh`       | 升级 matter-server                   |
| `uninstall.sh`    | 卸载 matter-server 环境及配置             |
| `autocheck.sh`    | 单服务自检与性能监控                    |


## 操作命令及管理规范

### 1. 在 `isgservicemonitor` 下启停命令
| 操作    | 命令                                                                                |
| ----- | --------------------------------------------------------------------------------- |
| 启动    | `echo u > /data/data/com.termux/files/usr/var/service/matter-server/supervise/control` |
| 停止    | `echo d > /data/data/com.termux/files/usr/var/service/matter-server/supervise/control` |
| 禁用自启动 | `touch /data/data/com.termux/files/usr/var/service/matter-server/down`                 |
| 启用自启动 | `rm -f /data/data/com.termux/files/usr/var/service/matter-server/down`                 |

#### 2 安装服务
1） 使用如下方式安装
    proot-distro login ubuntu << 'EOF'
    commands
    'EOF'
2） 与依赖分开安装，避免由于依赖无法安装影响应用的安装

##### 2.1 安装系统依赖

```bash
apt update
apt install -y \
    build-essential \
    libssl-dev \
    libffi-dev \
    python3-dev \
    git \
    cmake \
    ninja-build \
```

---

##### 2.2 创建 Python 虚拟环境

```bash
pyenv install 3.12.6
pyenv virtualenv 3.12.6 matter-server-env
pyenv activate matter-server-env
```

---

### ⬆️ 安装 Python 库依赖

```bash
pip install cryptography
```

---

### ⬆️ 克隆并编译 connectedhomeip (Matter SDK)

```bash
cd ~
git clone --recursive https://github.com/project-chip/connectedhomeip.git
cd connectedhomeip

git checkout v2023-09-28

gn gen out/python --args='is_debug=false is_component_build=false python_bindings=true'
ninja -C out/python

pip install ./out/python/python_dist/chip_python-*.whl

python -c "import chip; print(chip.__version__)"
```

---

### ⬆️ 安装 python-matter-server

```bash
pip install python-matter-server

# 若需源码形式
cd ~
git clone https://github.com/your-repo/python-matter-server.git
cd python-matter-server
pip install -e .

pip show python-matter-server
```

---

### ⬆️ 配置 config.yaml

```bash
mkdir ~/matter-server
cd ~/matter-server
nano config.yaml
```

示例 config.yaml:

```yaml
mqtt:
  broker: 'mqtt://localhost:1883'
  username: 'your_mqtt_username'
  password: 'your_mqtt_password'

matter:
  listen_ip: '0.0.0.0'
  port: 8443
  ssl:
    certfile: '/path/to/certificate.pem'
    keyfile: '/path/to/privatekey.pem'
```

---

### ⬆️ 生成自签名证书

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout ~/matter-server/privatekey.pem \
    -out ~/matter-server/certificate.pem
```

---

### ⬆️ 启动 python-matter-server

```bash
python -m matter_server --config ~/matter-server/config.yaml
```

---

## ⚠️ 补充建议

* 确保 MQTT 服务已启动，如 mosquitto
* 可将 matter-server 注册为 systemd 或 supervisor 定位运行
* 在 matter-server 相关目录中执行 `pyenv local matter-server-env`
* 生产环境推荐使用合法 SSL 证书


### 注册 servicemonitor 服务看护

```bash
SERVICE_CONTROL_DIR="/data/data/com.termux/files/usr/var/service/$SERVICE_ID"   # service monitor 路径
RUN_FILE="$SERVICE_CONTROL_DIR/run"   # run 文件路径
DOWN_FILE="$SERVICE_CONTROL_DIR/down"   # down 文件路径

mkdir -p "$SERVICE_CONTROL_DIR"   # 确保 service monitor 目录存在

cat << 'EOF' > "$RUN_FILE"
#!/data/data/com.termux/files/usr/bin/sh 
export PROCESS_TAG="$PROCESS_TAG"
exec proot-distro login ubuntu << EOF
cd /opt/matter-server/
source venv/bin/activate
matter-server
EOF
2>&1
EOF

chmod +x "$RUN_FILE"   # 赋予 run 文件执行权限

touch "$DOWN_FILE"   # 创建 down 文件，禁用服务的自动启动
echo "✅ run 和 down 文件已生成: $RUN_FILE, $DOWN_FILE"   # 提示 run 与 down 文件生成成功
```

### 3 验证安装版本
```bash
proot-distro login ubuntu -- bash -c "source /opt/matter-server/venv/bin/activate && pip show python-matter-server | grep ^Version: | awk '{print \$2}'"
```
### 4. MQTT上报
BASE_DIR="/data/data/com.termux/files/home/servicemanager"
CONFIG_FILE="$BASE_DIR/configuration.yaml"
MQTT broker信息来自于CONFIG_FILE里的mqtt

---

### 5. 路径定义
common_paths.sh 仅仅是统一路径定义的规范
不要加载统一路径定义，每个脚本使用独立参数，无需依赖common_paths.sh

### 6. autocheck要求
无特殊要求

### 7. 备份还原要求
还原后需要重启应用，验证还原是否成功

### 8. 状态查询要求
status.sh, 通过查版本号来确定程序是否安装，增加mqtt状态上报，install：true/false

### 8. 其它要求
关键步骤加上中文注释
Termux 专用的临时目录：
  - TERMUX_TMP_DIR="/data/data/com.termux/files/usr/tmp"
  - TEMP_DIR="$TERMUX_TMP_DIR/${SERVICE_ID}_temp"
