参照isg-credential-services脚本包，进行isg-adb-server服务管理脚本包设计，分别设计和创建每个脚本文件，以下是基本要求：

## 整体要求
1、脚本将运行在安卓系统的termux apk中；
2、脚本有root权限，但我们执行这个脚本时，脚本内部可以加su， 但是执行脚本的命令不能加su， 只能是bash install.sh类似这样来执行。

# isg-adb-server 服务管理脚本包设计

**Service ID:** `isg-adb-server`

---

## 脚本文件清单及功能说明

| 脚本名           | 功能描述                               |
| ---------------- | -------------------------------------- |
| `install.sh`     | 安装并配置 isg-adb-server 服务同时启动adb server          |
| `start.sh`       | 启动 isg-adb-server（开启 adb server）  |
| `stop.sh`        | 停止 isg-adb-server（关闭 adb server）  |
| `status.sh`      | 查询 adb server 运行状态（基于 5555 端口） |
| `uninstall.sh`   | 卸载 isg-adb-server 环境及配置          |
| `autocheck.sh`   | 单服务自检与性能监控（确认 adb 服务可连接） |

---

## 操作命令及管理规范

### 1. 在 `isgservicemonitor` 下启停命令

| 操作     | 命令                                                                                 |
| -------- | ------------------------------------------------------------------------------------ |
| 启动     | `echo u > /data/data/com.termux/files/usr/var/service/isg-adb-server/supervise/control` |
| 停止     | `echo d > /data/data/com.termux/files/usr/var/service/isg-adb-server/supervise/control` |
| 禁用自启动 | `touch /data/data/com.termux/files/usr/var/service/isg-adb-server/down`                |
| 启用自启动 | `rm -f /data/data/com.termux/files/usr/var/service/isg-adb-server/down`                |

---

### 2. 安装服务

⬆️ **安装 isg-adb-server**

```bash
if ! bash -c "
    pkg update -y
    pkg install -y android-tools
    su -c 'setprop service.adb.tcp.port 5555'
    su -c 'stop adbd'
    su -c 'start adbd'
    adb connect 127.0.0.1:5555
"; then
    log "failed to install isg-adb-server"
    mqtt_report "isg/install/$SERVICE_ID/status" "{\"status\":\"failed\",\"message\":\"isg-adb-server installation failed\",\"timestamp\":$(date +%s)}"
    record_install_history "FAILED" "unknown"
    exit 1
fi
```

---

### 3. 注册 servicemonitor 服务看护

```bash
log "registering servicemonitor service"

# 创建服务目录
mkdir -p "$SERVICE_CONTROL_DIR"

# 写入 run 启动脚本
cat << 'EOF' > "$RUN_FILE"
#!/data/data/com.termux/files/usr/bin/sh
# 启动 isg-adb-server
su -c 'setprop service.adb.tcp.port 5555'
su -c 'stop adbd'
su -c 'start adbd'
adb connect 127.0.0.1:5555
EOF

chmod +x "$RUN_FILE"
touch "$DOWN_FILE"   # 初始状态不自启
```

---

### 4. MQTT 上报

- 保持与 `isg-credential-services` 相同规范  
- 安装、状态、错误均需通过 MQTT 上报  

---

### 5. 状态查询要求

- `bash status.sh`：仅输出 `running/stopped`  
- `bash status.sh --json`：输出详细 JSON，包括安装情况与端口状态（adb 5555）  

---

### 6. autocheck 要求

- 确认 adb server 是否监听在 5555 端口  
- 使用 `adb devices` 确认本机回环地址是否已连接  
- 输出基本健康状态（running/failed）  

---

### 7. 升级命令

- `update.sh` 仅需重新执行 install.sh 步骤  
- 检查是否已安装 android-tools，若版本不变则跳过  

---

### 8. 其它要求

- 关键步骤加中文注释  
- 临时目录定义：  

```bash
TERMUX_TMP_DIR="/data/data/com.termux/files/usr/tmp"
TEMP_DIR="$TERMUX_TMP_DIR/${SERVICE_ID}_temp"
```
