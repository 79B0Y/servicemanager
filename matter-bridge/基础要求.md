参照matter-server脚本包，进行matter-bridge服务管理脚本包设计，分别设计和创建每个脚本文件，以下是基本要求：


# matter-bridge 服务管理脚本包设计

**Service ID:** `matter-bridge`


## 脚本文件清单及功能说明

| 脚本名               | 功能描述                          |
| ----------------- | ----------------------------- |
| `common_paths.sh` | 统一路径定义                        |
| `install.sh`      | 安装 matter-bridge 服务                |
| `start.sh`        | 启动 matter-bridge 服务                |
| `stop.sh`         | 停止 matter-bridge 服务，恢复 `.disabled` |
| `status.sh`       | 查询服务运行状态，依据 PID 和 8482 端口     |
| `update.sh`       | 升级 matter-bridge                   |
| `uninstall.sh`    | 卸载 matter-bridge 环境及配置             |
| `autocheck.sh`    | 单服务自检与性能监控                    |


## 操作命令及管理规范

### 1. 在 `isgservicemonitor` 下启停命令
| 操作    | 命令                                                                                |
| ----- | --------------------------------------------------------------------------------- |
| 启动    | `echo u > /data/data/com.termux/files/usr/var/service/matter-bridge/supervise/control` |
| 停止    | `echo d > /data/data/com.termux/files/usr/var/service/matter-bridge/supervise/control` |
| 禁用自启动 | `touch /data/data/com.termux/files/usr/var/service/matter-bridge/down`                 |
| 启用自启动 | `rm -f /data/data/com.termux/files/usr/var/service/matter-bridge/down`                 |

#### 2 安装服务
1）  proot-distro login ubuntu方式安装
    proot-distro login ubuntu << 'EOF'
    commands
    'EOF'
2） 与依赖分开安装，避免由于依赖无法安装影响应用的安装


### ⬆️ 安装 matter-bridge

```bash
if ! proot-distro login "$PROOT_DISTRO" -- bash -c "
    npm install -g home-assistant-matter-hub
"; then
    log "failed to install matter-bridge"
    mqtt_report "isg/install/$SERVICE_ID/status" "{\"status\":\"failed\",\"message\":\"matter-bridge installation failed\",\"timestamp\":$(date +%s)}"
    record_install_history "FAILED" "unknown"
    exit 1
fi
```

---
### ⬆️ 获取版本

```bash
get_current_version() {
    proot-distro login "$PROOT_DISTRO" -- bash -c '
        if command -v home-assistant-matter-hub >/dev/null 2>&1; then
            home-assistant-matter-hub --version 2>/dev/null | grep -Eo "[0-9]+\.[0-9]+\.[0-9]+" || echo "unknown"
        else
            echo "unknown"
        fi
    ' 2>/dev/null || echo "unknown"
}
```

---
### ⬆️ 生成启动脚本
proot-distro login ubuntu -- bash -c '
START_SCRIPT="/usr/lib/node_modules/home-assistant-matter-hub/matter-bridge-start.sh"
TOKEN_FILE="/sdcard/isgbackup/hass/token.txt"

mkdir -p "$(dirname "$START_SCRIPT")"

cat << EOF > "$START_SCRIPT"
#!/bin/bash

export HUB_PORT=8482
export HA_URL="http://127.0.0.1:8123"

TOKEN_FILE="$TOKEN_FILE"
if [ -f "\$TOKEN_FILE" ]; then
  export HA_TOKEN=\$(cat "\$TOKEN_FILE" | tr -d "\r\n")
else
  echo "[❌] HA token 文件不存在: \$TOKEN_FILE" >&2
  exit 1
fi

echo "[✅] 启动 Home Assistant Matter Hub..."
exec home-assistant-matter-hub start \\
  --home-assistant-url="\$HA_URL" \\
  --home-assistant-access-token="\$HA_TOKEN" \\
  --http-port="\$HUB_PORT" \\
  --log-level=info
EOF

chmod +x "$START_SCRIPT"
'
---



### 注册 servicemonitor 服务看护

```bash
# -----------------------------------------------------------------------------
# 注册 servicemonitor 服务看护
# -----------------------------------------------------------------------------
log "registering servicemonitor service"
mqtt_report "isg/install/$SERVICE_ID/status" "{\"status\":\"installing\",\"message\":\"registering servicemonitor service\",\"timestamp\":$(date +%s)}"

# 创建服务目录
mkdir -p "$SERVICE_CONTROL_DIR"

# 写入 run 启动脚本
cat << 'EOF' > "$RUN_FILE"
#!/data/data/com.termux/files/usr/bin/sh
# 启动 Home Assistant Matter Bridge 服务
START_SCRIPT="/usr/lib/node_modules/home-assistant-matter-hub/matter-bridge-start.sh"

if [ ! -f "$START_SCRIPT" ]; then
  echo "[❌] 启动脚本不存在: $START_SCRIPT" >&2
  exit 1
fi

exec proot-distro login ubuntu -- bash -c "bash '$START_SCRIPT'"
EOF

chmod +x "$RUN_FILE"

# 创建 down 文件（初始状态不自启）
touch "$DOWN_FILE"
```

### 3 验证安装版本
```bash
get_current_version() {
    proot-distro login "$PROOT_DISTRO" -- bash -c '
        if command -v home-assistant-matter-hub >/dev/null 2>&1; then
            home-assistant-matter-hub --version 2>/dev/null | grep -Eo "[0-9]+\.[0-9]+\.[0-9]+" || echo "unknown"
        else
            echo "unknown"
        fi
    ' 2>/dev/null || echo "unknown"
}
```
### 4. MQTT上报
BASE_DIR="/data/data/com.termux/files/home/servicemanager"
CONFIG_FILE="$BASE_DIR/configuration.yaml"
MQTT broker信息来自于CONFIG_FILE里的mqtt

---

### 5. 路径定义
common_paths.sh 仅仅是统一路径定义的规范
不要加载统一路径定义，每个脚本使用独立参数，无需依赖common_paths.sh

### 6. autocheck要求
无特殊要求，config信息可以只输出端口号

### 7. 备份还原要求
还原后需要重启应用，验证还原是否成功
执行bash restore.sh -c，直接执行初始化配置
备份，打包/root/.matter_server/目录下所有数据

### 8. 状态查询要求
bash status.sh, 只输出running/stopped
通过查版本号来确定程序是否安装，增加mqtt状态上报，install：true/false
bash status.sh --json 输出详细json内容

### 9. 升级命令
npm install -g home-assistant-matter-hub@latest
升级前先检查版本，如果当前版本比需要升级的版本新，则skip升级

### 10. 其它要求
关键步骤加上中文注释
Termux 专用的临时目录：
  - TERMUX_TMP_DIR="/data/data/com.termux/files/usr/tmp"
  - TEMP_DIR="$TERMUX_TMP_DIR/${SERVICE_ID}_temp"
